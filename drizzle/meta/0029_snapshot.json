{
  "id": "8efc7458-a5ef-43dc-9447-7abcc25bcfd6",
  "prevId": "f1aef8aa-a44a-4772-82dd-7fc63ae013aa",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.api_keys": {
      "name": "api_keys",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "clerk_user_id": {
          "name": "clerk_user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "encrypted_key": {
          "name": "encrypted_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "encrypted_key_hash": {
          "name": "encrypted_key_hash",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "last_used_at": {
          "name": "last_used_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "deleted_at": {
          "name": "deleted_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "api_keys_encrypted_key_hash_key": {
          "name": "api_keys_encrypted_key_hash_key",
          "columns": [
            {
              "expression": "encrypted_key_hash",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "api_keys_encrypted_key_key": {
          "name": "api_keys_encrypted_key_key",
          "columns": [
            {
              "expression": "encrypted_key",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "api_keys_encrypted_key_unique": {
          "name": "api_keys_encrypted_key_unique",
          "nullsNotDistinct": false,
          "columns": [
            "encrypted_key"
          ]
        },
        "api_keys_encrypted_key_hash_unique": {
          "name": "api_keys_encrypted_key_hash_unique",
          "nullsNotDistinct": false,
          "columns": [
            "encrypted_key_hash"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.appeal_actions": {
      "name": "appeal_actions",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "appeal_id": {
          "name": "appeal_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "AppealActionStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "via": {
          "name": "via",
          "type": "Via",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'Inbound'"
        },
        "clerk_user_id": {
          "name": "clerk_user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "appeal_actions_appeal_id_fkey": {
          "name": "appeal_actions_appeal_id_fkey",
          "tableFrom": "appeal_actions",
          "tableTo": "appeals",
          "columnsFrom": [
            "appeal_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.appeals": {
      "name": "appeals",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_action_id": {
          "name": "user_action_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "sort": {
          "name": "sort",
          "type": "serial",
          "primaryKey": false,
          "notNull": true
        },
        "action_status": {
          "name": "action_status",
          "type": "AppealActionStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "action_status_created_at": {
          "name": "action_status_created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "appeals_clerk_organization_id_idx": {
          "name": "appeals_clerk_organization_id_idx",
          "columns": [
            {
              "expression": "clerk_organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "appeals_user_action_id_idx": {
          "name": "appeals_user_action_id_idx",
          "columns": [
            {
              "expression": "user_action_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "appeals_user_action_id_key": {
          "name": "appeals_user_action_id_key",
          "columns": [
            {
              "expression": "user_action_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "appeals_sort_key": {
          "name": "appeals_sort_key",
          "columns": [
            {
              "expression": "sort",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "int4_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "appeals_user_action_id_fkey": {
          "name": "appeals_user_action_id_fkey",
          "tableFrom": "appeals",
          "tableTo": "user_actions",
          "columnsFrom": [
            "user_action_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "appeals_user_action_id_unique": {
          "name": "appeals_user_action_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "user_action_id"
          ]
        },
        "appeals_sort_unique": {
          "name": "appeals_sort_unique",
          "nullsNotDistinct": false,
          "columns": [
            "sort"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.email_templates": {
      "name": "email_templates",
      "schema": "",
      "columns": {
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "EmailTemplateType",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "content": {
          "name": "content",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {
        "email_templates_pkey": {
          "name": "email_templates_pkey",
          "columns": [
            "clerk_organization_id",
            "type"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.messages": {
      "name": "messages",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_action_id": {
          "name": "user_action_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "to_id": {
          "name": "to_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "from_id": {
          "name": "from_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "type": {
          "name": "type",
          "type": "MessageType",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "subject": {
          "name": "subject",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "text": {
          "name": "text",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "MessageStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "appeal_id": {
          "name": "appeal_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "sort": {
          "name": "sort",
          "type": "serial",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "messages_sort_key": {
          "name": "messages_sort_key",
          "columns": [
            {
              "expression": "sort",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "int4_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "messages_appeal_id_fkey": {
          "name": "messages_appeal_id_fkey",
          "tableFrom": "messages",
          "tableTo": "appeals",
          "columnsFrom": [
            "appeal_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "cascade"
        },
        "messages_from_id_fkey": {
          "name": "messages_from_id_fkey",
          "tableFrom": "messages",
          "tableTo": "user_records",
          "columnsFrom": [
            "from_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "cascade"
        },
        "messages_user_action_id_fkey": {
          "name": "messages_user_action_id_fkey",
          "tableFrom": "messages",
          "tableTo": "user_actions",
          "columnsFrom": [
            "user_action_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        },
        "messages_to_id_fkey": {
          "name": "messages_to_id_fkey",
          "tableFrom": "messages",
          "tableTo": "user_records",
          "columnsFrom": [
            "to_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "messages_sort_unique": {
          "name": "messages_sort_unique",
          "nullsNotDistinct": false,
          "columns": [
            "sort"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.moderations": {
      "name": "moderations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "ModerationStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "pending": {
          "name": "pending",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "via": {
          "name": "via",
          "type": "Via",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'AI'"
        },
        "reasoning": {
          "name": "reasoning",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "record_id": {
          "name": "record_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "ruleset_id": {
          "name": "ruleset_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "clerk_user_id": {
          "name": "clerk_user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "test_mode": {
          "name": "test_mode",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "tokens": {
          "name": "tokens",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {
        "moderations_record_id_idx": {
          "name": "moderations_record_id_idx",
          "columns": [
            {
              "expression": "record_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "moderations_org_status_idx": {
          "name": "moderations_org_status_idx",
          "columns": [
            {
              "expression": "clerk_organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            },
            {
              "expression": "status",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "moderations_record_id_fkey": {
          "name": "moderations_record_id_fkey",
          "tableFrom": "moderations",
          "tableTo": "records",
          "columnsFrom": [
            "record_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        },
        "moderations_ruleset_id_fkey": {
          "name": "moderations_ruleset_id_fkey",
          "tableFrom": "moderations",
          "tableTo": "rulesets",
          "columnsFrom": [
            "ruleset_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.moderations_to_rules": {
      "name": "moderations_to_rules",
      "schema": "",
      "columns": {
        "moderation_id": {
          "name": "moderation_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "rule_id": {
          "name": "rule_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "moderations_to_rules_moderation_id_fkey": {
          "name": "moderations_to_rules_moderation_id_fkey",
          "tableFrom": "moderations_to_rules",
          "tableTo": "moderations",
          "columnsFrom": [
            "moderation_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "cascade"
        },
        "moderations_to_rules_rule_id_fkey": {
          "name": "moderations_to_rules_rule_id_fkey",
          "tableFrom": "moderations_to_rules",
          "tableTo": "rules",
          "columnsFrom": [
            "rule_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {
        "moderations_to_rules_moderation_id_rule_id_pk": {
          "name": "moderations_to_rules_moderation_id_rule_id_pk",
          "columns": [
            "moderation_id",
            "rule_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organizations": {
      "name": "organizations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "stripe_customer_id": {
          "name": "stripe_customer_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "emails_enabled": {
          "name": "emails_enabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "test_mode_enabled": {
          "name": "test_mode_enabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": true
        },
        "appeals_enabled": {
          "name": "appeals_enabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "stripe_api_key": {
          "name": "stripe_api_key",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "moderation_percentage": {
          "name": "moderation_percentage",
          "type": "double precision",
          "primaryKey": false,
          "notNull": true,
          "default": 100
        },
        "suspension_threshold": {
          "name": "suspension_threshold",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 1
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "organizations_clerk_organization_id_key": {
          "name": "organizations_clerk_organization_id_key",
          "columns": [
            {
              "expression": "clerk_organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organizations_clerk_organization_id_unique": {
          "name": "organizations_clerk_organization_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "clerk_organization_id"
          ]
        },
        "organizations_stripe_customer_id_unique": {
          "name": "organizations_stripe_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "stripe_customer_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.preset_strategies": {
      "name": "preset_strategies",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "StrategyType",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "preset_id": {
          "name": "preset_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "options": {
          "name": "options",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "preset_strategies_preset_id_fkey": {
          "name": "preset_strategies_preset_id_fkey",
          "tableFrom": "preset_strategies",
          "tableTo": "presets",
          "columnsFrom": [
            "preset_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.presets": {
      "name": "presets",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "default": {
          "name": "default",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.records": {
      "name": "records",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "client_id": {
          "name": "client_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "client_url": {
          "name": "client_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "entity": {
          "name": "entity",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "text": {
          "name": "text",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "image_urls": {
          "name": "image_urls",
          "type": "text[]",
          "primaryKey": false,
          "notNull": true,
          "default": "'{}'"
        },
        "external_urls": {
          "name": "external_urls",
          "type": "text[]",
          "primaryKey": false,
          "notNull": true,
          "default": "'{}'"
        },
        "protected": {
          "name": "protected",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "user_record_id": {
          "name": "user_record_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "sort": {
          "name": "sort",
          "type": "serial",
          "primaryKey": false,
          "notNull": true
        },
        "moderation_status": {
          "name": "moderation_status",
          "type": "ModerationStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "moderation_status_created_at": {
          "name": "moderation_status_created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": false
        },
        "moderation_pending": {
          "name": "moderation_pending",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "moderation_pending_created_at": {
          "name": "moderation_pending_created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": false
        },
        "deleted_at": {
          "name": "deleted_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "records_clerk_organization_id_idx": {
          "name": "records_clerk_organization_id_idx",
          "columns": [
            {
              "expression": "clerk_organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "records_client_id_key": {
          "name": "records_client_id_key",
          "columns": [
            {
              "expression": "client_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "records_user_record_id_idx": {
          "name": "records_user_record_id_idx",
          "columns": [
            {
              "expression": "user_record_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "records_sort_key": {
          "name": "records_sort_key",
          "columns": [
            {
              "expression": "sort",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "int4_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "records_user_record_id_fkey": {
          "name": "records_user_record_id_fkey",
          "tableFrom": "records",
          "tableTo": "user_records",
          "columnsFrom": [
            "user_record_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "records_client_id_unique": {
          "name": "records_client_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "client_id"
          ]
        },
        "records_sort_unique": {
          "name": "records_sort_unique",
          "nullsNotDistinct": false,
          "columns": [
            "sort"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.rule_strategies": {
      "name": "rule_strategies",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "StrategyType",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "rule_id": {
          "name": "rule_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "options": {
          "name": "options",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "rule_strategies_rule_id_fkey": {
          "name": "rule_strategies_rule_id_fkey",
          "tableFrom": "rule_strategies",
          "tableTo": "rules",
          "columnsFrom": [
            "rule_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.rules": {
      "name": "rules",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "preset_id": {
          "name": "preset_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "ruleset_id": {
          "name": "ruleset_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "rules_preset_id_fkey": {
          "name": "rules_preset_id_fkey",
          "tableFrom": "rules",
          "tableTo": "presets",
          "columnsFrom": [
            "preset_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        },
        "rules_ruleset_id_fkey": {
          "name": "rules_ruleset_id_fkey",
          "tableFrom": "rules",
          "tableTo": "rulesets",
          "columnsFrom": [
            "ruleset_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.rulesets": {
      "name": "rulesets",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.subscriptions": {
      "name": "subscriptions",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "stripe_subscription_id": {
          "name": "stripe_subscription_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "subscriptions_clerk_organization_id_key": {
          "name": "subscriptions_clerk_organization_id_key",
          "columns": [
            {
              "expression": "clerk_organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_actions": {
      "name": "user_actions",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_record_id": {
          "name": "user_record_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "UserActionStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "via": {
          "name": "via",
          "type": "Via",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'Automation'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "clerk_user_id": {
          "name": "clerk_user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "reasoning": {
          "name": "reasoning",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "via_record_id": {
          "name": "via_record_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "via_appeal_id": {
          "name": "via_appeal_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "user_actions_user_record_id_idx": {
          "name": "user_actions_user_record_id_idx",
          "columns": [
            {
              "expression": "user_record_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "user_actions_via_record_id_records_id_fk": {
          "name": "user_actions_via_record_id_records_id_fk",
          "tableFrom": "user_actions",
          "tableTo": "records",
          "columnsFrom": [
            "via_record_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "cascade"
        },
        "user_actions_via_appeal_id_appeals_id_fk": {
          "name": "user_actions_via_appeal_id_appeals_id_fk",
          "tableFrom": "user_actions",
          "tableTo": "appeals",
          "columnsFrom": [
            "via_appeal_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "set null",
          "onUpdate": "cascade"
        },
        "user_actions_user_record_id_fkey": {
          "name": "user_actions_user_record_id_fkey",
          "tableFrom": "user_actions",
          "tableTo": "user_records",
          "columnsFrom": [
            "user_record_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_records": {
      "name": "user_records",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "client_id": {
          "name": "client_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "client_url": {
          "name": "client_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "stripe_account_id": {
          "name": "stripe_account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "username": {
          "name": "username",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "protected": {
          "name": "protected",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "sort": {
          "name": "sort",
          "type": "serial",
          "primaryKey": false,
          "notNull": true
        },
        "action_status": {
          "name": "action_status",
          "type": "UserActionStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "action_status_created_at": {
          "name": "action_status_created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": false
        },
        "flagged_records_count": {
          "name": "flagged_records_count",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {
        "users_clerk_organization_id_idx": {
          "name": "users_clerk_organization_id_idx",
          "columns": [
            {
              "expression": "clerk_organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "users_client_id_key": {
          "name": "users_client_id_key",
          "columns": [
            {
              "expression": "client_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "users_sort_key": {
          "name": "users_sort_key",
          "columns": [
            {
              "expression": "sort",
              "isExpression": false,
              "asc": true,
              "nulls": "last",
              "opclass": "int4_ops"
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_records_client_id_unique": {
          "name": "user_records_client_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "client_id"
          ]
        },
        "user_records_sort_unique": {
          "name": "user_records_sort_unique",
          "nullsNotDistinct": false,
          "columns": [
            "sort"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.webhook_endpoints": {
      "name": "webhook_endpoints",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "secret": {
          "name": "secret",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.webhook_events": {
      "name": "webhook_events",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "webhook_endpoint_id": {
          "name": "webhook_endpoint_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "event_type": {
          "name": "event_type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "payload": {
          "name": "payload",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "WebhookEventStatus",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp (3)",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "webhook_events_webhook_endpoint_id_fkey": {
          "name": "webhook_events_webhook_endpoint_id_fkey",
          "tableFrom": "webhook_events",
          "tableTo": "webhook_endpoints",
          "columnsFrom": [
            "webhook_endpoint_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.AppealActionStatus": {
      "name": "AppealActionStatus",
      "schema": "public",
      "values": [
        "Open",
        "Rejected",
        "Approved"
      ]
    },
    "public.EmailTemplateType": {
      "name": "EmailTemplateType",
      "schema": "public",
      "values": [
        "Suspended",
        "Compliant",
        "Banned"
      ]
    },
    "public.MessageStatus": {
      "name": "MessageStatus",
      "schema": "public",
      "values": [
        "Pending",
        "Delivered"
      ]
    },
    "public.MessageType": {
      "name": "MessageType",
      "schema": "public",
      "values": [
        "Outbound",
        "Inbound"
      ]
    },
    "public.ModerationStatus": {
      "name": "ModerationStatus",
      "schema": "public",
      "values": [
        "Compliant",
        "Flagged"
      ]
    },
    "public.StrategyType": {
      "name": "StrategyType",
      "schema": "public",
      "values": [
        "Blocklist",
        "Classifier",
        "Prompt"
      ]
    },
    "public.UserActionStatus": {
      "name": "UserActionStatus",
      "schema": "public",
      "values": [
        "Compliant",
        "Suspended",
        "Banned"
      ]
    },
    "public.Via": {
      "name": "Via",
      "schema": "public",
      "values": [
        "Inbound",
        "Manual",
        "Automation",
        "AI",
        "Automation Flagged Record",
        "Automation All Compliant",
        "Automation Appeal Approved"
      ]
    },
    "public.WebhookEventStatus": {
      "name": "WebhookEventStatus",
      "schema": "public",
      "values": [
        "Pending",
        "Sent",
        "Failed"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {
    "public.moderations_analytics_daily": {
      "columns": {
        "time": {
          "name": "time",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "moderations": {
          "name": "moderations",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "flagged": {
          "name": "flagged",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "flagged_by_rule": {
          "name": "flagged_by_rule",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        }
      },
      "definition": "\n  WITH time_filtered_moderations AS (\n    SELECT \n      \"moderations\".\"id\" as moderation_id,\n      \"moderations\".\"clerk_organization_id\" as clerk_organization_id,\n      \"moderations\".\"created_at\" as created_at,\n      \"moderations\".\"status\" as status\n    FROM \"moderations\"\n    WHERE \"moderations\".\"created_at\" AT TIME ZONE 'UTC' >= date_trunc('day', now() AT TIME ZONE 'UTC') - INTERVAL '29 days'\n  ),\n  flagged_moderations AS (\n    SELECT \n      m.moderation_id,\n      m.clerk_organization_id,\n      m.created_at,\n      m.status,\n      \"moderations_to_rules\".\"rule_id\" as rule_id,\n      COALESCE(\"presets\".\"name\", \"rules\".\"name\") as rule_name,\n      COALESCE(\"presets\".\"description\", \"rules\".\"description\") as rule_description\n    FROM time_filtered_moderations m\n    LEFT JOIN \"moderations_to_rules\" ON m.moderation_id = \"moderations_to_rules\".\"moderation_id\"\n    LEFT JOIN \"rules\" ON \"moderations_to_rules\".\"rule_id\" = \"rules\".\"id\"\n    LEFT JOIN \"presets\" ON \"rules\".\"preset_id\" = \"presets\".\"id\"\n    WHERE m.status = 'Flagged'\n  ),\n  rule_counts AS (\n    SELECT\n      date_trunc('day', m.created_at AT TIME ZONE 'UTC') AS time,\n      m.clerk_organization_id,\n      rule_id,\n      COUNT(*) as rule_count,\n      MAX(rule_name) as rule_name,\n      MAX(rule_description) as rule_description\n    FROM flagged_moderations m\n    WHERE rule_id IS NOT NULL\n    GROUP BY time, m.clerk_organization_id, rule_id\n  )\n  SELECT\n    date_trunc('day', m.created_at AT TIME ZONE 'UTC') as time,\n    m.clerk_organization_id as clerk_organization_id,\n    COUNT(*)::int AS moderations,\n    COUNT(*) FILTER (WHERE m.status = 'Flagged')::int AS flagged,\n    COALESCE(\n      jsonb_object_agg(\n        rc.rule_id,\n        jsonb_build_object(\n          'count', rc.rule_count,\n          'name', rc.rule_name,\n          'description', rc.rule_description\n        )\n      ) FILTER (WHERE rc.rule_id IS NOT NULL),\n      '{}'::jsonb\n    ) AS flagged_by_rule\n  FROM time_filtered_moderations m\n  LEFT JOIN rule_counts rc ON \n    date_trunc('day', m.created_at AT TIME ZONE 'UTC') = rc.time AND \n    m.clerk_organization_id = rc.clerk_organization_id\n  GROUP BY date_trunc('day', m.created_at AT TIME ZONE 'UTC'), m.clerk_organization_id\n",
      "name": "moderations_analytics_daily",
      "schema": "public",
      "isExisting": false,
      "materialized": true
    },
    "public.moderations_analytics_hourly": {
      "columns": {
        "time": {
          "name": "time",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "clerk_organization_id": {
          "name": "clerk_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "moderations": {
          "name": "moderations",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "flagged": {
          "name": "flagged",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "flagged_by_rule": {
          "name": "flagged_by_rule",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        }
      },
      "definition": "\n  WITH time_filtered_moderations AS (\n    SELECT \n      \"moderations\".\"id\" as moderation_id,\n      \"moderations\".\"clerk_organization_id\" as clerk_organization_id,\n      \"moderations\".\"created_at\" as created_at,\n      \"moderations\".\"status\" as status\n    FROM \"moderations\"\n    WHERE \"moderations\".\"created_at\" AT TIME ZONE 'UTC' >= date_trunc('hour', now() AT TIME ZONE 'UTC') - INTERVAL '23 hours'\n  ),\n  flagged_moderations AS (\n    SELECT \n      m.moderation_id,\n      m.clerk_organization_id,\n      m.created_at,\n      m.status,\n      \"moderations_to_rules\".\"rule_id\" as rule_id,\n      COALESCE(\"presets\".\"name\", \"rules\".\"name\") as rule_name,\n      COALESCE(\"presets\".\"description\", \"rules\".\"description\") as rule_description\n    FROM time_filtered_moderations m\n    LEFT JOIN \"moderations_to_rules\" ON m.moderation_id = \"moderations_to_rules\".\"moderation_id\"\n    LEFT JOIN \"rules\" ON \"moderations_to_rules\".\"rule_id\" = \"rules\".\"id\"\n    LEFT JOIN \"presets\" ON \"rules\".\"preset_id\" = \"presets\".\"id\"\n    WHERE m.status = 'Flagged'\n  ),\n  rule_counts AS (\n    SELECT\n      date_trunc('hour', m.created_at AT TIME ZONE 'UTC') AS time,\n      m.clerk_organization_id,\n      rule_id,\n      COUNT(*) as rule_count,\n      MAX(rule_name) as rule_name,\n      MAX(rule_description) as rule_description\n    FROM flagged_moderations m\n    WHERE rule_id IS NOT NULL\n    GROUP BY time, m.clerk_organization_id, rule_id\n  )\n  SELECT\n    date_trunc('hour', m.created_at AT TIME ZONE 'UTC') as time,\n    m.clerk_organization_id as clerk_organization_id,\n    COUNT(*)::int AS moderations,\n    COUNT(*) FILTER (WHERE m.status = 'Flagged')::int AS flagged,\n    COALESCE(\n      jsonb_object_agg(\n        rc.rule_id,\n        jsonb_build_object(\n          'count', rc.rule_count,\n          'name', rc.rule_name,\n          'description', rc.rule_description\n        )\n      ) FILTER (WHERE rc.rule_id IS NOT NULL),\n      '{}'::jsonb\n    ) AS flagged_by_rule\n  FROM time_filtered_moderations m\n  LEFT JOIN rule_counts rc ON \n    date_trunc('hour', m.created_at AT TIME ZONE 'UTC') = rc.time AND \n    m.clerk_organization_id = rc.clerk_organization_id\n  GROUP BY date_trunc('hour', m.created_at AT TIME ZONE 'UTC'), m.clerk_organization_id\n",
      "name": "moderations_analytics_hourly",
      "schema": "public",
      "isExisting": false,
      "materialized": true
    }
  },
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}